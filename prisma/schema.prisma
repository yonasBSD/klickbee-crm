generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  deals            Deal[]
  todo             Todo[]
  linkedTodos      Todo[]     @relation("linkedUser")
  assignedTodos    Todo[]     @relation("assignedUser")
  meetings         Meeting[]
  linkedMeetings   Meeting[]  @relation("linkedUser")
  assignedMeetings Meeting[]  @relation("assignedUser")
  prospects        Prospect[] @relation("userId")
  prospectsOwner   Prospect[] @relation("ownerId")
  customers        Customer[] @relation("customer_user")
  customersOwner   Customer[] @relation("customer_owner")
  companiesByUser  Company[]  @relation("company_user")
  companiesByOwner Company[]  @relation("company_owner")
  activityLogs     ActivityLog[]
}

enum DealStage {
  New
  Contacted
  Proposal
  Negotiation
  Won
  Lost
}

enum Currency {
  USD
  EUR
  GBP
}

model Deal {
  id        String    @id @default(uuid())
  dealName  String
  companyId String?
  company   Company?  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contactId String?
  contact   Customer? @relation(fields: [contactId], references: [id], onDelete: Cascade)
  stage     DealStage
  amount    Float
  currency  Currency
  ownerId   String
  owner     User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  closeDate DateTime?
  tags      String[]  @default([])
  notes     String?
  files     Json?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([ownerId])
}

enum TodoStatus {
  Todo
  InProgress
  OnHold
  Done
}

enum TodoPriority {
  Low
  Medium
  High
  Urgent
}

model Todo {
  id         String       @id @default(uuid())
  taskName   String
  linkedTo   User         @relation("linkedUser", fields: [linkedId], references: [id], onDelete: Cascade)
  linkedId   String
  assignedTo User?        @relation("assignedUser", fields: [assignedId], references: [id], onDelete: Cascade)
  assignedId String?
  status     TodoStatus
  priority   TodoPriority
  dueDate    DateTime?
  notes      String?
  files      Json?
  ownerId    String
  owner      User         @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@index([ownerId])
  @@index([linkedId])
  @@index([assignedId])
}

enum MeetingStatus {
  Scheduled
  Confirmed
  Cancelled
}

enum MeetingFrequency {
  Daily
  Weekly
  Monthly
  Yearly
}

enum MeetingEnds {
  Never
  After
  OnDate
}

enum ActivityAction {
  Create
  Update
  Delete
}

model Meeting {
  id            String           @id @default(uuid())
  title         String
  startDate     DateTime?
  startTime     DateTime?
  endTime       DateTime?
  repeatMeeting Boolean          @default(false)
  frequency     MeetingFrequency @default(Daily)
  repeatOn      String?
  repeatEvery   Int              @default(0)
  ends          MeetingEnds      @default(Never)
  location      String?
  linkedTo      User             @relation("linkedUser", fields: [linkedId], references: [id], onDelete: Cascade)
  linkedId      String
  assignedTo    User?            @relation("assignedUser", fields: [assignedId], references: [id], onDelete: Cascade)
  assignedId    String?
  participants  String[]         @default([])
  status        MeetingStatus    @default(Scheduled)
  tags          String[]         @default([])
  notes         String?
  files         Json?
  ownerId       String
  owner         User             @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  link          String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  @@index([ownerId])
  @@index([linkedId])
  @@index([assignedId])
}

enum ProspectStatus {
  New
  Cold
  Qualified
  Warmlead
  Converted
  Notintrested
}

model Prospect {
  id        String         @id @default(uuid())
  userId    String
  user      User           @relation("userId", fields: [userId], references: [id], onDelete: Cascade)
  fullName  String
  companyId String?
  company   Company?       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  email     String?
  phone     String?
  status    ProspectStatus @default(New)
  tags      String[]       @default([])
  notes     String?
  ownerId   String
  owner     User           @relation("ownerId", fields: [ownerId], references: [id], onDelete: Cascade)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@index([ownerId])
  @@index([userId])
}

enum CustomerStatus {
  Active
  FollowUp
  inactive
}

model Customer {
  id        String         @id @default(uuid())
  userId    String
  user      User           @relation("customer_user", fields: [userId], references: [id], onDelete: Cascade)
  fullName  String
  companyId String?
  company   Company?       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  email     String?
  phone     String?
  status    CustomerStatus @default(Active)
  tags      String[]       @default([])
  notes     String?
  files     Json?
  ownerId   String
  owner     User           @relation("customer_owner", fields: [ownerId], references: [id], onDelete: Cascade)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  deals     Deal[]

  @@index([ownerId])
  @@index([userId])
}

enum CompanyStatus {
  Active
  FollowUp
  inactive
}

model Company {
  id        String        @id @default(uuid())
  userId    String
  user      User          @relation("company_user", fields: [userId], references: [id], onDelete: Cascade)
  fullName  String
  industry  String
  email     String?
  phone     String?
  website   String?
  status    CompanyStatus @default(Active)
  tags      String[]      @default([])
  assing    String[]      @default([])
  notes     String?
  files     Json?
  ownerId   String
  owner     User          @relation("company_owner", fields: [ownerId], references: [id], onDelete: Cascade)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  deals     Deal[]
  prospects Prospect[]
  customers Customer[]

  @@index([ownerId])
  @@index([userId])
}

model ActivityLog {
  id             String          @id @default(uuid())
  entityType     String
  entityId       String
  action         ActivityAction
  changedFields  String[]        @default([])
  previousValues Json?
  newValues      Json?
  metadata       Json?
  performedById  String
  performedBy    User            @relation(fields: [performedById], references: [id], onDelete: Cascade)
  createdAt      DateTime        @default(now())

  @@index([entityType, entityId])
  @@index([performedById])
}
