generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  deals         Deal[]
  linkedTodos   Todo[] @relation("linkedUser")
  assignedTodos Todo[] @relation("assignedUser")
}

enum DealStage {
  New
  Qualified
  Proposal
  Won
  Lost
}

enum Currency {
  USD
  EUR
  GBP
}

model Deal {
  id        String    @id @default(uuid())
  dealName  String
  company   String
  contact   String?
  stage     DealStage
  amount    Float
  currency  Currency
  ownerId   String
  owner     User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  closeDate DateTime?
  tags      String[]  @default([])
  notes     String?
  files     Json? // array of file metadata objects (name, url, size, etc.)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([ownerId])
}

enum TodoStatus {
  Todo
  InProgress
  OnHold
  Done
}

enum TodoPriority {
  Low
  Medium
  High
  Urgent
}

model Todo {
  id         String       @id @default(uuid())
  taskName   String
  linkedTo   User         @relation("linkedUser", fields: [linkedId], references: [id], onDelete: Cascade)
  linkedId   String
  assignedTo User?        @relation("assignedUser", fields: [assignedId], references: [id], onDelete: Cascade)
  assignedId String?
  status     TodoStatus
  priority   TodoPriority
  dueDate    DateTime?
  notes      String?
  files      Json?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@index([linkedId])
  @@index([assignedId])
}
